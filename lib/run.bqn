#!/usr/bin/env bqn

# Opinionated CLI: Uses specific flags rather than positional chaos.
# Usage: bqn lib/run.bqn --rows 4096 --duration 5 --interval 0.01

ts â† â€¢Import (â€¢path) âˆ¾ "/tensor.bqn"

# 1. Parse Arguments
raw_args â† â€¢Args
ParseArg â† {
  keyâ€¿default â† ğ•©
  idx â† raw_args âŠ âŸ¨keyâŸ©
  idx < â‰ raw_args ? â€¢ParseFloat (idx+1) âŠ‘ raw_args ; default
}

rows     â† ParseArg "--rows"â€¿4096
duration â† ParseArg "--duration"â€¿5     # Seconds
interval â† ParseArg "--interval"â€¿0.01  # Seconds

# 2. Derive Parameters
cols  â† ts.MetricCount 0
cores â† ts.CoreCount 0
steps â† âŒŠ duration Ã· interval

â€¢Show "TensorScan Config:"
â€¢Show âŸ¨"Rows:", rows, "Duration:", duration, "Interval:", interval, "Steps:", stepsâŸ©

# 3. Execution
â€¢Show "Starting Capture..."
snaps â† ts.Capture stepsâ€¿rowsâ€¿colsâ€¿interval

# 4. Processing (Standard Pipeline)
_keysâ€¿timesâ€¿tensor â† ts.Tensor4D snapsâ€¿cores

â€¢Show "Capture Complete. Generating Density View for utime..."
ts.DensityView timesâ€¿tensorâ€¿ts.utime

ts.TsFreeThreadResources 0
